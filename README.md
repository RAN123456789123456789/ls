# 图书借阅小程序 - 完整配置指南

## 📚 目录

### 1. 快速开始
- [域名配置指南](#域名配置)
- [云托管部署](#云托管部署)
- [功能配置](#功能配置)

### 2. 配置文档
- [小程序域名配置完整指南](./小程序域名配置完整指南.md) - 域名配置详细说明
- [正式环境配置说明](./正式环境配置说明.md) - 正式环境部署指南
- [云托管部署说明](./云托管部署说明.md) - 后端服务部署指南

### 3. 功能文档
- [借阅功能配置说明](./借阅功能配置说明.md) - 借阅功能使用说明
- [管理员设置说明](./管理员设置说明.md) - 管理员配置指南
- [后端订阅消息接口实现指南](./后端订阅消息接口实现指南.md) - 订阅消息功能

### 4. 测试和排查
- [手机测试指南](./手机测试指南.md) - 真机测试步骤
- [小程序错误排查指南](./小程序错误排查指南.md) - 常见问题排查
- [API测试方法](./API测试方法.md) - API接口测试方法

---

## 🚀 快速开始

### 域名配置

#### 测试环境（立即可用）
1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入 **开发** → **开发管理** → **开发设置**
3. 在 **request合法域名** 中添加：
   ```
   https://express-bec5-197615-5-1385276628.sh.run.tcloudbase.com
   ```
4. 点击 **保存**

⚠️ **注意**：云托管默认域名仅用于测试，正式环境必须使用自定义域名。

#### 正式环境（必须配置）
1. 在微信云托管添加自定义域名（如 `api.ranguofang.com`）
2. 配置DNS解析（CNAME记录）
3. 在微信公众平台添加自定义域名
4. 更新代码中的API地址
5. 域名备案（如果使用主域名）

详细步骤请查看：[小程序域名配置完整指南](./小程序域名配置完整指南.md)

### 云托管部署

1. **配置环境变量**
   - `WX_APPID` - 小程序 AppID
   - `WX_SECRET` - 小程序 Secret

2. **配置代码仓库**
   - 在云托管控制台配置GitHub仓库
   - 选择分支：`main`

3. **部署服务**
   - 点击"发布"按钮
   - 等待构建和部署完成

详细步骤请查看：[云托管部署说明](./云托管部署说明.md)

### 功能配置

#### 借阅功能
- 图书管理
- 借阅申请
- 借阅记录
- 归还管理

详细说明请查看：[借阅功能配置说明](./借阅功能配置说明.md)

#### 管理员功能
- 管理员登录
- 图书审核
- 借阅审核
- 用户管理

详细说明请查看：[管理员设置说明](./管理员设置说明.md)

---

## 📝 重要说明

### 关于服务器
- ✅ **不需要购买服务器**：使用微信云托管，无需自己购买服务器
- ✅ **不需要服务器备案**：云托管已处理服务器备案
- ✅ **自动SSL证书**：云托管自动配置HTTPS证书

### 关于域名
- ⚠️ **测试环境**：可以使用云托管默认域名
- ⚠️ **正式环境**：必须使用自定义域名
- ⚠️ **域名备案**：如果使用主域名，可能需要ICP备案

---

## 🔧 常见问题

### 1. 小程序无法访问API？
- 检查是否在微信公众平台配置了服务器域名
- 确认域名配置正确（只填写域名，不包含路径）
- 确保使用 `https://` 协议

### 2. 获取头像失败？
- 已修复：使用新的头像昵称填写能力（`open-type="chooseAvatar"`）
- 不再使用已废弃的 `wx.getUserProfile` API

### 3. 域名配置问题？
- 查看 [小程序域名配置完整指南](./小程序域名配置完整指南.md)
- 检查DNS配置是否正确（使用CNAME记录）
- 确认域名已绑定到云托管服务

---

## 📞 技术支持

如遇到问题，请查看：
- [小程序错误排查指南](./小程序错误排查指南.md)
- [API测试方法](./API测试方法.md)
- [手机测试指南](./手机测试指南.md)

---

## 📄 文档列表

### 配置文档
- [小程序域名配置完整指南](./小程序域名配置完整指南.md)
- [正式环境配置说明](./正式环境配置说明.md)
- [云托管部署说明](./云托管部署说明.md)

### 功能文档
- [借阅功能配置说明](./借阅功能配置说明.md)
- [管理员设置说明](./管理员设置说明.md)
- [后端订阅消息接口实现指南](./后端订阅消息接口实现指南.md)

### 测试文档
- [手机测试指南](./手机测试指南.md)
- [小程序错误排查指南](./小程序错误排查指南.md)
- [API测试方法](./API测试方法.md)



