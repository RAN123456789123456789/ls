<!--pages/books/books.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-box" wx:if="{{showSearch}}">
      <input 
        class="search-input" 
        placeholder="æœç´¢å›¾ä¹¦åç§°ã€ä½œè€…ã€ISBN"
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-clear" bindtap="onClearSearch">Ã—</text>
    </view>
    <view class="search-icon" wx:else bindtap="toggleSearch">
      <text class="iconfont">ğŸ”</text>
    </view>
  </view>

  <!-- æ ‡ç­¾æ  -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === 'borrow' ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="borrow"
    >
      <text class="tab-text">å€Ÿé˜…</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'return' ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="return"
    >
      <text class="tab-text">è¿˜ä¹¦</text>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸï¼šæ ¹æ®é€‰ä¸­çš„æ ‡ç­¾æ˜¾ç¤ºä¸åŒå†…å®¹ -->
  <view class="content-wrapper">
    <!-- å€Ÿé˜…å†…å®¹ -->
    <view class="content-section" wx:if="{{currentTab === 'borrow'}}">
      <scroll-view 
        class="section-content" 
        scroll-y
        refresher-enabled
        refresher-triggered="{{loading}}"
        bindrefresherrefresh="onPullDownRefresh"
      >
        <view class="section-inner">
          <view wx:if="{{loading && availableBooks.length === 0}}" class="loading">
            <text>åŠ è½½ä¸­...</text>
          </view>
          
          <view wx:elif="{{availableBooks.length === 0}}" class="empty">
            <text>æš‚æ— å¯å€Ÿé˜…å›¾ä¹¦</text>
          </view>

          <view 
            class="book-item" 
            wx:for="{{availableBooks}}" 
            wx:key="id"
            bindtap="onBookTap"
            data-bookid="{{item.id}}"
          >
            <image class="book-cover" src="{{item.cover || '/images/default-book.png'}}" mode="aspectFill" />
            <view class="book-info">
              <text class="book-name">{{item.name}}</text>
              <text class="book-author" wx:if="{{item.author}}">ä½œè€…ï¼š{{item.author}}</text>
              <view class="book-meta">
                <text class="book-category" wx:if="{{item.category}}">{{item.category}}</text>
                <text class="book-count">å¯å€Ÿï¼š{{item.availableCount}}/{{item.totalCount}}</text>
              </view>
            </view>
            <view class="book-action">
              <text class="arrow">â€º</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- è¿˜ä¹¦å†…å®¹ -->
    <view class="content-section" wx:elif="{{currentTab === 'return'}}">
      <scroll-view 
        class="section-content" 
        scroll-y
        refresher-enabled
        refresher-triggered="{{loading}}"
        bindrefresherrefresh="onPullDownRefresh"
      >
        <view class="section-inner">
          <view wx:if="{{loading && borrowedRecords.length === 0}}" class="loading">
            <text>åŠ è½½ä¸­...</text>
          </view>
          
          <view wx:elif="{{borrowedRecords.length === 0}}" class="empty">
            <text>æš‚æ— å€Ÿé˜…è®°å½•</text>
          </view>

          <view 
            class="record-item" 
            wx:for="{{borrowedRecords}}" 
            wx:key="id"
          >
            <view class="record-header">
              <text class="book-name">{{item.bookName}}</text>
              <text class="days-info {{item.daysType}}">
                {{item.daysText}}
              </text>
            </view>
            
            <view class="record-info">
              <view class="info-row">
                <text class="info-label">å€Ÿé˜…æ—¥æœŸï¼š</text>
                <text class="info-value">{{item.borrowDate}}</text>
              </view>
              <view class="info-row">
                <text class="info-label">å½’è¿˜æ—¥æœŸï¼š</text>
                <text class="info-value">{{item.returnDate}}</text>
              </view>
            </view>

            <view class="record-actions">
              <button
                class="return-btn"
                bindtap="onReturnBook"
                data-recordid="{{item.id}}"
                data-bookname="{{item.bookName}}"
              >
                <text class="btn-text">å½’è¿˜</text>
              </button>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>

