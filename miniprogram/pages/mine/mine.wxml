<!--mine.wxml-->
<view class="container">
  <!-- 未登录状态 -->
  <view class="login-section" wx:if="{{!isLoggedIn}}">
    <view class="login-card">
      <view class="login-icon">👤</view>
      <text class="login-title">欢迎使用图书借阅系统</text>
      <text class="login-desc">请先登录以使用完整功能</text>
      
      <!-- 登录按钮：直接触发微信原生头像选择 -->
      <button 
        class="login-btn" 
        open-type="chooseAvatar"
        bind:chooseavatar="onChooseAvatar"
        disabled="{{loading}}"
        loading="{{loading}}"
      >
        <text class="btn-text">{{loading ? '登录中...' : '微信一键登录'}}</text>
      </button>
    </view>
  </view>

  <!-- 已登录状态 -->
  <scroll-view class="user-section" scroll-y wx:else>
    <!-- 用户信息卡片 -->
    <view class="user-card">
      <view class="user-header">
        <view class="avatar-wrapper" bindtap="handleEditAvatar">
          <image 
            class="avatar" 
            src="{{userInfo.avatarUrl || 'https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0'}}" 
            mode="aspectFill"
          ></image>
        </view>
        <view class="user-info">
          <view class="nickname-wrapper">
            <text class="nickname">{{userInfo.nickName || '未设置昵称'}}</text>
            <text class="edit-name-icon" bindtap="handleEditName">✏️</text>
          </view>
          <view class="phone-wrapper">
            <text class="user-id" wx:if="{{phoneNumber}}">{{phoneNumber}}</text>
            <text class="user-id-placeholder" wx:else>未绑定手机号</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 编辑按钮 -->
    <view class="edit-section">
      <button class="edit-btn" bindtap="handleEditProfile">
        <text class="btn-text">编辑资料</text>
      </button>
    </view>

    <!-- 操作按钮 -->
    <view class="action-section">
      <button class="admin-btn" bindtap="goToAdminLogin">管理员登录</button>
      <button class="logout-btn" bindtap="handleLogout">退出登录</button>
    </view>

    <!-- 编辑名称弹窗 -->
    <view class="modal" wx:if="{{showEditNameModal}}" bindtap="closeEditNameModal">
      <view class="modal-content" catchtap="stopPropagation">
        <view class="modal-header">
          <text class="modal-title">修改昵称</text>
          <text class="modal-close" bindtap="closeEditNameModal">✕</text>
        </view>
        <view class="modal-body">
          <input 
            class="name-input" 
            type="text" 
            placeholder="请输入新昵称" 
            value="{{editNickName}}"
            bindinput="onNickNameInput"
            maxlength="20"
          />
        </view>
        <view class="modal-footer">
          <button class="modal-btn cancel-btn" bindtap="closeEditNameModal">取消</button>
          <button class="modal-btn confirm-btn" bindtap="confirmEditName">确定</button>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 手机号输入弹窗 -->
  <view class="modal" wx:if="{{showPhoneInputModal}}" bindtap="closePhoneInputModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">输入手机号</text>
        <text class="modal-close" bindtap="closePhoneInputModal">✕</text>
      </view>
      <view class="modal-body">
        <input 
          class="name-input" 
          type="number" 
          placeholder="请输入11位手机号" 
          value="{{inputPhoneNumber}}"
          bindinput="onPhoneNumberInput"
          maxlength="11"
        />
        <text class="input-hint">请输入11位手机号码</text>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="closePhoneInputModal">取消</button>
        <button class="modal-btn confirm-btn" bindtap="confirmManualPhoneNumber">确定</button>
      </view>
    </view>
  </view>
</view>
