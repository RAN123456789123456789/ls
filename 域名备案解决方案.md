# 域名备案解决方案

## 🔍 问题原因

**错误信息**：`域名未备案`

微信云托管要求自定义域名必须完成ICP备案才能使用。

## ✅ 解决方案

### 方案1：完成域名备案（推荐，长期方案）

#### 备案要求

- **主域名**（`ranguofang.com`）：必须备案
- **子域名**（`api.ranguofang.com`）：如果主域名已备案，通常不需要单独备案

#### 备案步骤

1. **准备材料**
   - 身份证（个人备案）或营业执照（企业备案）
   - 域名证书（域名服务商提供）
   - 其他可能需要的材料

2. **选择备案服务商**
   - 如果域名在腾讯云购买：在腾讯云备案
   - 如果域名在其他服务商购买：在该服务商备案
   - 或在腾讯云备案（需要将域名转入腾讯云）

3. **开始备案**
   - 访问：https://beian.miit.gov.cn/
   - 或通过域名服务商的备案系统
   - 填写备案信息
   - 上传材料
   - 提交审核

4. **等待审核**
   - 审核时间：通常 **3-20个工作日**
   - 期间会有人工审核，可能需要补充材料

5. **备案完成后**
   - 等待腾讯云与工信部数据同步（通常1-24小时）
   - 然后在云托管添加域名

#### 备案时间线

- **提交备案**：1-2天
- **初审**：1-3天
- **提交管局**：1-2天
- **管局审核**：7-20天
- **备案完成**：总计约 **10-25个工作日**

### 方案2：使用云托管默认域名（临时方案）

在域名备案期间，可以使用云托管的默认域名。

#### 云托管默认域名格式

```
https://express-bec5-197615-5-1385276628.sh.run.tcloudbase.com
```

#### 使用步骤

1. **获取默认域名**
   - 在云托管控制台
   - 进入 express-bec5 服务
   - 查看"访问地址"或"默认域名"

2. **更新小程序代码中的API地址**
   - 文件：`miniprogram/utils/userService.ts`
   - 文件：`miniprogram/utils/subscribeService.ts`
   - 文件：`miniprogram/utils/borrowService.ts`
   - 文件：`miniprogram/utils/borrowRequestService.ts`
   
   将 `API_BASE_URL` 改为默认域名：
   ```typescript
   const API_BASE_URL = 'https://express-bec5-197615-5-1385276628.sh.run.tcloudbase.com/api';
   ```

3. **在微信公众平台配置域名**
   - 登录 [微信公众平台](https://mp.weixin.qq.com/)
   - 进入 **开发** → **开发管理** → **开发设置**
   - 在 **request合法域名** 中添加默认域名

4. **重新编译小程序**

#### 默认域名的限制

- ✅ 可以正常使用
- ✅ 支持HTTPS（自动配置）
- ❌ 域名较长，不够美观
- ❌ 可能有时效性（需要确认）

### 方案3：使用子域名（如果主域名已备案）

如果 `ranguofang.com` 已经备案，可以尝试使用子域名：

- `api.ranguofang.com`
- `service.ranguofang.com`
- `backend.ranguofang.com`

子域名通常不需要单独备案（如果主域名已备案）。

## 📋 推荐流程

### 立即可以做的（使用默认域名）

1. ✅ 获取云托管默认域名
2. ✅ 更新小程序代码中的API地址
3. ✅ 在微信公众平台配置默认域名
4. ✅ 测试功能

### 长期方案（完成备案）

1. ⏳ 提交域名备案申请
2. ⏳ 等待审核（10-25个工作日）
3. ⏳ 备案完成后，在云托管添加自定义域名
4. ⏳ 更新代码使用自定义域名

## 🔧 备案详细步骤（腾讯云）

### 1. 登录腾讯云备案系统

- 访问：https://console.cloud.tencent.com/beian
- 或通过腾讯云控制台 → 备案管理

### 2. 开始备案

1. **填写备案信息**
   - 备案类型：首次备案
   - 域名：`ranguofang.com`
   - 服务器：选择微信云托管（如果有选项）

2. **填写主体信息**
   - 个人备案：身份证信息
   - 企业备案：营业执照信息

3. **填写网站信息**
   - 网站名称
   - 网站内容
   - 网站负责人信息

4. **上传材料**
   - 身份证正反面（个人）
   - 营业执照（企业）
   - 其他要求的材料

5. **提交审核**
   - 确认信息无误
   - 提交备案申请

### 3. 等待审核

- **初审**：腾讯云审核（1-3天）
- **提交管局**：提交到工信部（1-2天）
- **管局审核**：工信部审核（7-20天）

### 4. 备案完成

- 收到备案成功的通知
- 等待腾讯云数据同步（1-24小时）
- 在云托管添加域名

## ⚠️ 重要提示

### 备案期间

- ✅ 可以使用云托管默认域名继续开发
- ✅ 功能不受影响
- ⏳ 等待备案完成后切换到自定义域名

### 备案完成后

1. **等待数据同步**
   - 备案完成后，腾讯云需要同步数据
   - 通常1-24小时
   - 如果立即添加失败，等待1小时后重试

2. **添加域名**
   - 在云托管控制台添加域名
   - 配置DNS CNAME记录
   - SSL证书自动配置

3. **更新代码**
   - 将API地址改为自定义域名
   - 重新编译小程序

## 💡 建议

**立即行动**：
1. 使用云托管默认域名继续开发（立即可用）
2. 同时提交域名备案申请（长期方案）

**备案完成后**：
1. 切换到自定义域名
2. 更新代码
3. 享受更专业的域名

## 📝 检查清单

### 使用默认域名（临时）
- [ ] 获取云托管默认域名
- [ ] 更新代码中的API地址
- [ ] 在微信公众平台配置默认域名
- [ ] 重新编译小程序
- [ ] 测试功能

### 完成备案（长期）
- [ ] 准备备案材料
- [ ] 提交备案申请
- [ ] 等待审核完成
- [ ] 等待数据同步
- [ ] 在云托管添加自定义域名
- [ ] 配置DNS
- [ ] 更新代码使用自定义域名

