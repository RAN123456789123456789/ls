# 自定义域名配置指南

## 📋 配置步骤

### 第一步：在微信云托管控制台添加域名

1. **登录腾讯云控制台**
   - 访问：https://console.cloud.tencent.com/
   - 进入 **微信云托管** 服务

2. **进入域名管理**
   - 选择你的云托管环境（express-bec5）
   - 进入 **域名管理** 或 **访问管理** 页面
   - 点击 **添加域名** 或 **绑定域名**

3. **添加自定义域名**
   - 输入域名：`ranguofang.com` 或 `api.ranguofang.com`（推荐使用子域名）
   - 选择需要绑定的服务（express-bec5）
   - 提交申请

4. **获取CNAME记录**
   - 添加域名后，系统会提供一个 **CNAME 记录值**
   - 格式类似：`xxxxx.tcloudbaseapp.com`
   - **请保存这个CNAME值，下一步需要用到**

### 第二步：配置DNS解析

1. **登录域名管理平台**
   - 找到你购买 `ranguofang.com` 的域名服务商（如：腾讯云、阿里云、GoDaddy等）
   - 进入域名管理控制台

2. **添加CNAME记录**
   - 记录类型：选择 **CNAME**
   - 主机记录：
     - 如果使用主域名：`@` 或留空
     - 如果使用子域名：`api`（推荐，这样API地址就是 `api.ranguofang.com`）
   - 记录值：填入第一步获取的 **CNAME值**
   - TTL：默认值或 600

3. **等待DNS生效**
   - DNS解析通常需要 5-30 分钟生效
   - 可以使用 `nslookup api.ranguofang.com` 或在线工具检查是否生效

### 第三步：等待域名审核（如果需要）

- 如果使用主域名 `ranguofang.com`，可能需要备案
- 如果使用子域名 `api.ranguofang.com`，通常不需要备案
- 等待腾讯云审核通过（通常几分钟到几小时）

### 第四步：更新代码中的API地址

配置完成后，需要更新项目中的API地址：

**需要更新的文件：**
1. `miniprogram/utils/subscribeService.ts`
2. `后端订阅消息接口实现指南.md`（文档）
3. `订阅功能实际部署配置清单.md`（文档）

**新的API地址格式：**
- 如果使用主域名：`https://ranguofang.com/api`
- 如果使用子域名：`https://api.ranguofang.com/api`（推荐）

## ⚠️ 注意事项

1. **推荐使用子域名**
   - 使用 `api.ranguofang.com` 而不是主域名
   - 这样可以保留主域名用于网站等其他用途

2. **HTTPS证书**
   - 微信云托管会自动为自定义域名配置SSL证书
   - 确保使用 `https://` 协议

3. **测试域名是否生效**
   ```bash
   # 测试DNS解析
   nslookup api.ranguofang.com
   
   # 测试API是否可访问
   curl https://api.ranguofang.com/api/subscribe/send
   ```

4. **域名备案**
   - 如果域名未备案，可能需要先备案
   - 备案通常需要几天时间

## 📝 配置完成后

配置完成后，请告诉我，我会帮你更新代码中的API地址。

或者你可以手动更新：
- 文件：`miniprogram/utils/subscribeService.ts`
- 第74行：将 `API_BASE_URL` 更新为新的域名地址


