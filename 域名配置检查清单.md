# 域名配置检查清单

## 🔍 当前状态

✅ **域名解析**：正常
- `ranguofang.com` → `47.96.143.78`

⚠️ **服务连接**：失败
- 新域名：连接失败
- 旧域名：503 Service Temporarily Unavailable

## 📋 需要检查的配置

### 1. 微信云托管域名绑定

**检查步骤**：
1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 进入 **微信云托管**
3. 选择你的环境（express-bec5）
4. 进入 **域名管理** 或 **访问管理**
5. 确认 `ranguofang.com` 已添加并绑定到服务

**如果未绑定**：
- 点击"添加域名"
- 输入 `ranguofang.com` 或 `api.ranguofang.com`（推荐）
- 选择要绑定的服务（express-bec5）
- 获取CNAME记录值

### 2. DNS解析配置

**检查步骤**：
1. 登录你的域名服务商控制台
2. 进入域名管理
3. 检查DNS解析记录

**正确的配置应该是**：
- **记录类型**：CNAME（不是A记录）
- **主机记录**：`@`（主域名）或 `api`（子域名）
- **记录值**：云托管提供的CNAME值（类似 `xxxxx.tcloudbaseapp.com`）

**错误的配置**：
- ❌ 使用A记录指向IP地址（`47.96.143.78`）
- ❌ 记录值不是CNAME

### 3. 后端服务状态

**检查步骤**：
1. 在微信云托管控制台
2. 查看服务列表
3. 确认 express-bec5 服务状态为"运行中"

**如果服务未运行**：
- 启动服务
- 检查服务配置
- 查看服务日志

### 4. SSL证书配置

**检查步骤**：
1. 在域名管理页面
2. 确认SSL证书状态为"已配置"或"有效"
3. 证书有效期应该显示未来日期

## 🔧 常见问题解决

### 问题1：域名解析指向IP而不是CNAME

**症状**：DNS解析显示A记录指向IP地址

**解决**：
1. 删除A记录
2. 添加CNAME记录
3. 记录值填写云托管提供的CNAME

### 问题2：域名未绑定到服务

**症状**：域名解析正常，但无法访问

**解决**：
1. 在云托管控制台添加域名
2. 绑定到正确的服务
3. 等待配置生效（通常几分钟）

### 问题3：后端服务未运行

**症状**：返回503错误

**解决**：
1. 启动后端服务
2. 检查服务配置
3. 查看服务日志排查错误

### 问题4：端口配置问题

**说明**：
- HTTPS默认使用443端口
- 微信云托管自动处理端口
- 不需要在URL中指定端口

**如果必须指定端口**：
- 说明配置可能有问题
- 检查云托管服务配置

## 📝 下一步操作

1. **检查云托管域名绑定**
   - [ ] 确认域名已添加
   - [ ] 确认域名已绑定到服务
   - [ ] 确认SSL证书已配置

2. **检查DNS配置**
   - [ ] 确认使用CNAME记录
   - [ ] 确认记录值正确
   - [ ] 等待DNS生效（5-30分钟）

3. **检查服务状态**
   - [ ] 确认服务正在运行
   - [ ] 查看服务日志
   - [ ] 确认没有错误

4. **重新测试**
   ```powershell
   # 测试基础连接
   Invoke-WebRequest -Uri "https://ranguofang.com/api" -Method GET -UseBasicParsing
   
   # 测试POST接口
   $body = '{"openId":"test","templateId":"test","data":{"thing1":{"value":"test"}}}'
   Invoke-WebRequest -Uri "https://ranguofang.com/api/subscribe/send" -Method POST -ContentType "application/json" -Body $body -UseBasicParsing
   ```

## 💡 推荐操作顺序

1. ✅ 先检查云托管控制台的域名绑定配置
2. ✅ 确认DNS使用CNAME记录（不是A记录）
3. ✅ 确认后端服务正在运行
4. ✅ 等待配置生效后重新测试

