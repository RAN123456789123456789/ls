# 小程序域名配置指南

## 问题描述

小程序请求的域名 `https://express-bec5-197615-5-1385276628.sh.run.tcloudbase.com` 不在合法域名列表中，导致请求失败。

## 配置步骤

### 方法一：在微信开发者工具中配置（开发环境）

1. **打开微信开发者工具**
2. **点击右上角的"详情"按钮**
3. **选择"本地设置"标签页**
4. **勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"**
   - 这个选项只在开发环境中有效
   - 发布到正式环境前必须配置合法域名

### 方法二：在小程序后台配置（正式环境必需）

1. **登录微信公众平台**
   - 访问：https://mp.weixin.qq.com
   - 使用小程序管理员账号登录

2. **进入小程序管理后台**
   - 点击左侧菜单"开发" -> "开发管理" -> "开发设置"

3. **配置服务器域名**
   - 找到"服务器域名"部分
   - 点击"修改"按钮
   - 在"request合法域名"中添加以下域名：
     ```
     https://express-bec5-197615-5-1385276628.sh.run.tcloudbase.com
     ```
   - 注意：只添加域名部分，不要包含协议（https://）后面的路径

4. **保存配置**
   - 点击"保存"按钮
   - 配置可能需要几分钟才能生效

## 需要配置的域名

根据代码中的使用情况，需要添加以下域名：

### request合法域名
```
https://express-bec5-197615-5-1385276628.sh.run.tcloudbase.com
```

## 注意事项

1. **域名格式**：
   - 只添加域名部分，不要包含路径
   - 例如：`express-bec5-197615-5-1385276628.sh.run.tcloudbase.com`
   - 不要写成：`https://express-bec5-197615-5-1385276628.sh.run.tcloudbase.com/api`

2. **协议要求**：
   - 小程序要求使用 HTTPS 协议
   - 确保你的服务器支持 HTTPS

3. **配置生效时间**：
   - 配置后可能需要几分钟才能生效
   - 如果配置后仍然报错，请等待几分钟后重试

4. **开发环境 vs 正式环境**：
   - 开发环境：可以在开发者工具中勾选"不校验合法域名"来跳过验证
   - 正式环境：必须在小程序后台配置合法域名

5. **域名数量限制**：
   - 每个小程序最多可以配置 20 个 request 合法域名

## 验证配置

配置完成后，可以通过以下方式验证：

1. **清除小程序缓存**
   - 在微信开发者工具中：工具 -> 清除缓存 -> 清除数据缓存

2. **重新编译运行**
   - 重新编译小程序
   - 查看控制台是否还有域名错误

3. **检查网络请求**
   - 在控制台的 Network 标签中查看请求是否成功
   - 确认请求的域名是否正确

## 常见问题

### Q: 配置后仍然报错？
A: 
- 检查域名是否正确（不要包含路径）
- 等待几分钟让配置生效
- 清除小程序缓存后重试
- 确认服务器支持 HTTPS

### Q: 开发环境可以跳过配置吗？
A: 
- 可以，在开发者工具中勾选"不校验合法域名"即可
- 但正式环境必须配置

### Q: 可以使用 IP 地址吗？
A: 
- 不可以，小程序要求使用域名，不能使用 IP 地址

### Q: 域名需要备案吗？
A: 
- 如果使用国内服务器，域名需要备案
- 如果使用云托管等腾讯云服务，通常已经处理了备案问题

## 相关文档

- [微信小程序网络请求文档](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)
- [小程序域名配置说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%9F%E5%90%8D)


