# 正式环境配置说明

## ✅ 重要说明：不需要购买服务器！

### 你已经在使用微信云托管

**当前情况：**
- ✅ 后端服务已部署在 **微信云托管**（express-bec5）
- ✅ 云托管是托管服务，**不需要你购买服务器**
- ✅ 云托管已经提供了服务器资源
- ✅ 你只需要配置自定义域名即可

### 微信云托管的优势

**使用云托管的好处：**
- ✅ **不需要购买服务器**：云托管已经提供了服务器
- ✅ **不需要服务器备案**：云托管已经处理了服务器备案
- ✅ **自动SSL证书**：自动配置HTTPS证书
- ✅ **自动扩容**：根据流量自动扩展
- ✅ **自动备份**：自动处理数据备份
- ✅ **监控和日志**：提供完整的监控和日志功能

## 📋 正式环境需要做什么

### 你只需要配置自定义域名

**不需要做的：**
- ❌ 不需要购买服务器
- ❌ 不需要配置服务器
- ❌ 不需要服务器备案
- ❌ 不需要配置SSL证书（云托管自动配置）

**需要做的：**
1. ✅ **购买域名**（如果还没有）
   - 域名：`ranguofang.com`（你已经有了）
   - 推荐使用子域名：`api.ranguofang.com`

2. ✅ **在微信云托管添加自定义域名**
   - 登录腾讯云控制台
   - 进入微信云托管 → 域名管理
   - 添加域名：`api.ranguofang.com`（推荐）或 `ranguofang.com`

3. ✅ **配置DNS解析**
   - 在域名服务商添加CNAME记录
   - 指向云托管提供的CNAME值

4. ✅ **域名备案**（如果需要）
   - 如果使用主域名 `ranguofang.com`，可能需要ICP备案
   - 如果使用子域名 `api.ranguofang.com`，通常不需要备案（如果主域名已备案）

5. ✅ **在微信公众平台配置域名**
   - 添加自定义域名到request合法域名

6. ✅ **更新代码中的API地址**
   - 将代码中的API地址从云托管默认域名改为自定义域名

## 💰 费用说明

### 云托管费用

**微信云托管通常是按量付费：**
- ✅ **免费额度**：通常有免费额度（如每月免费调用次数）
- 💰 **超出后**：按实际使用量付费（通常很便宜）
- 💰 **域名费用**：域名本身需要续费（通常每年几十元）

**不需要额外费用：**
- ❌ 不需要购买服务器（云托管已提供）
- ❌ 不需要购买SSL证书（云托管自动配置）
- ❌ 不需要购买CDN（可选，云托管已包含）

### 域名费用

- 💰 **域名购买/续费**：通常每年几十到几百元（取决于域名类型）
- 💰 **域名备案**：免费（但需要时间，3-20个工作日）

## 🎯 配置步骤总结

### 第一步：确认云托管服务正常运行

1. 登录腾讯云控制台
2. 进入微信云托管
3. 确认服务 `express-bec5` 状态为"运行中"

### 第二步：配置自定义域名

1. **在云托管添加域名**
   - 域名管理 → 添加域名
   - 输入：`api.ranguofang.com`（推荐）
   - 获取CNAME记录值

2. **配置DNS**
   - 登录域名服务商
   - 添加CNAME记录：`api` → 云托管CNAME值

3. **等待DNS生效**（5-30分钟）

### 第三步：配置微信公众平台

1. 登录微信公众平台
2. 开发 → 开发管理 → 开发设置
3. 在request合法域名中添加：`https://api.ranguofang.com`

### 第四步：更新代码

更新以下文件中的 `API_BASE_URL`：
- `miniprogram/utils/borrowRequestService.ts`
- `miniprogram/utils/borrowService.ts`
- `miniprogram/utils/subscribeService.ts`
- `miniprogram/utils/userService.ts`

从：
```typescript
const API_BASE_URL = 'https://express-bec5-197615-5-1385276628.sh.run.tcloudbase.com/api';
```

改为：
```typescript
const API_BASE_URL = 'https://api.ranguofang.com/api';
```

## 📝 总结

### 关键点

1. ✅ **不需要购买服务器**：你已经在使用微信云托管
2. ✅ **只需要配置自定义域名**：让小程序使用你自己的域名
3. ✅ **可能需要域名备案**：取决于使用的域名类型
4. ✅ **费用很低**：主要是域名费用和云托管按量付费

### 配置优先级

- 🟢 **测试阶段**：使用云托管默认域名（免费，立即可用）
- 🔴 **正式环境**：配置自定义域名（需要域名和DNS配置）

## 🎯 下一步

1. 确认云托管服务正常运行
2. 配置自定义域名（推荐使用 `api.ranguofang.com`）
3. 配置DNS解析
4. 在微信公众平台添加域名
5. 更新代码中的API地址

需要我帮你配置吗？我可以：
- 指导你在云托管添加域名
- 指导你配置DNS
- 帮你更新代码中的API地址



